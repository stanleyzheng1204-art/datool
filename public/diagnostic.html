<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ç½²è¯Šæ–­ - æ•°æ®åˆ†æåº”ç”¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .check-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .check-item:last-child {
            border-bottom: none;
        }
        .check-icon {
            margin-right: 12px;
            font-size: 20px;
        }
        .pass { color: #28a745; }
        .fail { color: #dc3545; }
        .warning { color: #ffc107; }
        .check-text {
            flex: 1;
        }
        .check-detail {
            color: #666;
            font-size: 13px;
            margin-top: 4px;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #5568d3;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .info-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-box h3 {
            color: #856404;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .info-box p {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            margin: 10px 0;
        }
        #logs {
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Cloudflare Pages éƒ¨ç½²è¯Šæ–­</h1>
        <p class="subtitle">æœ€åæ›´æ–°ï¼š2025-01-21 16:40</p>

        <div class="info-box">
            <h3>âš ï¸ å¦‚æœé¡µé¢æ˜¾ç¤º "hello word"</h3>
            <p>è¿™æ„å‘³ç€ Cloudflare Pages æ²¡æœ‰æ­£ç¡®éƒ¨ç½² Next.js åº”ç”¨ã€‚è¯·æ£€æŸ¥ä¸‹é¢çš„è¯Šæ–­ç»“æœã€‚</p>
        </div>

        <div class="section">
            <h2>1. åŸºç¡€æ£€æŸ¥</h2>
            <div id="basic-checks"></div>
        </div>

        <div class="section">
            <h2>2. æ–‡ä»¶æ£€æŸ¥</h2>
            <div id="file-checks"></div>
        </div>

        <div class="section">
            <h2>3. API æ£€æŸ¥</h2>
            <div id="api-checks"></div>
        </div>

        <div class="section">
            <h2>4. è¯Šæ–­æ—¥å¿—</h2>
            <pre id="logs"></pre>
        </div>

        <div class="section">
            <h2>5. å¿«é€Ÿæ“ä½œ</h2>
            <a href="/" class="btn">è¿”å›é¦–é¡µ</a>
            <a href="/version-demo" class="btn">è®¿é—®ç‰ˆæœ¬æ¼”ç¤ºé¡µ</a>
            <a href="https://dash.cloudflare.com/" target="_blank" class="btn btn-danger">æŸ¥çœ‹ Cloudflare Pages æ§åˆ¶å°</a>
        </div>
    </div>

    <script>
        const logs = [];
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] [${type.toUpperCase()}] ${message}`);
            updateLogs();
        }

        function updateLogs() {
            document.getElementById('logs').textContent = logs.join('\n');
        }

        function addCheck(containerId, text, status, detail = '') {
            const container = document.getElementById(containerId);
            const icon = status === 'pass' ? 'âœ…' : status === 'fail' ? 'âŒ' : 'âš ï¸';
            const statusClass = status === 'pass' ? 'pass' : status === 'fail' ? 'fail' : 'warning';
            
            container.innerHTML += `
                <div class="check-item">
                    <span class="check-icon ${statusClass}">${icon}</span>
                    <div class="check-text">
                        <div>${text}</div>
                        ${detail ? `<div class="check-detail">${detail}</div>` : ''}
                    </div>
                </div>
            `;
        }

        async function checkBasic() {
            log('å¼€å§‹åŸºç¡€æ£€æŸ¥...');
            
            // æ£€æŸ¥ JavaScript æ˜¯å¦åŠ è½½
            addCheck('basic-checks', 'JavaScript å·²å¯ç”¨', 'pass');
            log('JavaScript å·²å¯ç”¨');

            // æ£€æŸ¥å½“å‰é¡µé¢ URL
            const url = window.location.href;
            addCheck('basic-checks', 'å½“å‰ URL', 'pass', url);
            log(`å½“å‰ URL: ${url}`);

            // æ£€æŸ¥é¡µé¢æ ‡é¢˜
            const title = document.title;
            if (title.includes('éƒ¨ç½²è¯Šæ–­')) {
                addCheck('basic-checks', 'è¯Šæ–­é¡µé¢åŠ è½½æ­£å¸¸', 'pass');
                log('è¯Šæ–­é¡µé¢åŠ è½½æ­£å¸¸');
            } else {
                addCheck('basic-checks', 'è¯Šæ–­é¡µé¢åŠ è½½å¼‚å¸¸', 'fail', `æ ‡é¢˜: ${title}`);
                log('è¯Šæ–­é¡µé¢åŠ è½½å¼‚å¸¸', 'error');
            }
        }

        async function checkFiles() {
            log('å¼€å§‹æ–‡ä»¶æ£€æŸ¥...');

            // æ£€æŸ¥ VERSION.txt
            try {
                const versionRes = await fetch('/VERSION.txt');
                if (versionRes.ok) {
                    const versionText = await versionRes.text();
                    addCheck('file-checks', 'VERSION.txt å­˜åœ¨', 'pass', versionText.split('\n')[0]);
                    log(`VERSION.txt: ${versionText.split('\n')[0]}`);
                } else {
                    addCheck('file-checks', 'VERSION.txt ä¸å­˜åœ¨', 'fail', `çŠ¶æ€: ${versionRes.status}`);
                    log('VERSION.txt ä¸å­˜åœ¨', 'error');
                }
            } catch (e) {
                addCheck('file-checks', 'VERSION.txt è®¿é—®å¤±è´¥', 'fail', e.message);
                log(`VERSION.txt è®¿é—®å¤±è´¥: ${e.message}`, 'error');
            }

            // æ£€æŸ¥ _next ç›®å½•
            try {
                const jsRes = await fetch('/_next/static/chunks/main-app.js');
                if (jsRes.ok) {
                    addCheck('file-checks', 'Next.js é™æ€æ–‡ä»¶å­˜åœ¨', 'pass');
                    log('Next.js é™æ€æ–‡ä»¶å­˜åœ¨');
                } else {
                    addCheck('file-checks', 'Next.js é™æ€æ–‡ä»¶ä¸å­˜åœ¨', 'fail', `çŠ¶æ€: ${jsRes.status}`);
                    log('Next.js é™æ€æ–‡ä»¶ä¸å­˜åœ¨', 'error');
                }
            } catch (e) {
                addCheck('file-checks', 'Next.js é™æ€æ–‡ä»¶è®¿é—®å¤±è´¥', 'fail', e.message);
                log(`Next.js é™æ€æ–‡ä»¶è®¿é—®å¤±è´¥: ${e.message}`, 'error');
            }

            // æ£€æŸ¥é¦–é¡µ HTML
            try {
                const htmlRes = await fetch('/');
                const htmlText = await htmlRes.text();
                if (htmlText.includes('æ•°æ®åˆ†æåº”ç”¨')) {
                    addCheck('file-checks', 'é¦–é¡µåŒ…å«æ­£ç¡®å†…å®¹', 'pass');
                    log('é¦–é¡µåŒ…å«æ­£ç¡®å†…å®¹');
                } else if (htmlText.includes('hello word')) {
                    addCheck('file-checks', 'é¦–é¡µæ˜¾ç¤ºé”™è¯¯å†…å®¹', 'fail', 'æ£€æµ‹åˆ° "hello word"');
                    log('é¦–é¡µæ˜¾ç¤ºé”™è¯¯å†…å®¹: hello word', 'error');
                } else {
                    addCheck('file-checks', 'é¦–é¡µå†…å®¹å¼‚å¸¸', 'warning', 'æœªæ£€æµ‹åˆ°é¢„æœŸå†…å®¹');
                    log('é¦–é¡µå†…å®¹å¼‚å¸¸', 'warning');
                }
            } catch (e) {
                addCheck('file-checks', 'é¦–é¡µè®¿é—®å¤±è´¥', 'fail', e.message);
                log(`é¦–é¡µè®¿é—®å¤±è´¥: ${e.message}`, 'error');
            }
        }

        async function checkAPI() {
            log('å¼€å§‹ API æ£€æŸ¥...');

            // æ£€æŸ¥ analyze API
            try {
                const apiRes = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: '{}'
                });
                if (apiRes.ok) {
                    const apiData = await apiRes.json();
                    addCheck('api-checks', '/api/analyze å¯è®¿é—®', 'pass', `çŠ¶æ€: ${apiRes.status}`);
                    log(`/api/analyze å“åº”: ${JSON.stringify(apiData)}`);
                } else {
                    addCheck('api-checks', '/api/analyze è¿”å›é”™è¯¯', 'warning', `çŠ¶æ€: ${apiRes.status}`);
                    log(`/api/analyze çŠ¶æ€: ${apiRes.status}`, 'warning');
                }
            } catch (e) {
                addCheck('api-checks', '/api/analyze è®¿é—®å¤±è´¥', 'fail', e.message);
                log(`/api/analyze è®¿é—®å¤±è´¥: ${e.message}`, 'error');
            }
        }

        async function runDiagnostics() {
            log('=== å¼€å§‹è¯Šæ–­ ===');
            await checkBasic();
            await checkFiles();
            await checkAPI();
            log('=== è¯Šæ–­å®Œæˆ ===');
        }

        runDiagnostics();
    </script>
</body>
</html>
